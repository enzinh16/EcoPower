<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Dispositivo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <h1 id="nome"></h1>
    <p><strong>Consumo:</strong> <span id="consumo"></span></p>
    <p><strong>Prioridade:</strong> <span id="prioridade"></span></p>

    <h2>Editar</h2>
    <label>Nome: <input id="inputNome"></label><br><br>
    <label>Prioridade: <input id="inputPrioridade" type="number" min="1"></label><br><br>
    <button id="salvar">Salvar</button>

    <script>
        let dispositivoAtual;

        // pega o ID da URL
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        fetch("/ler-json")
            .then(res => res.json())
            .then(dispositivos => {
                dispositivoAtual = dispositivos.find(d => d.id == id);
                if (dispositivoAtual) {
                    document.getElementById("nome").textContent = dispositivoAtual.nome;
                    document.getElementById("consumo").textContent = dispositivoAtual.consumo;
                    document.getElementById("prioridade").textContent = dispositivoAtual.prioridade;
                    document.getElementById("inputNome").value = dispositivoAtual.nome;
                    document.getElementById("inputPrioridade").value = dispositivoAtual.prioridade;
                }
            });

        document.getElementById("salvar").addEventListener("click", async () => {
            const novoNome = document.getElementById("inputNome").value;
            const novaPrioridade = parseInt(document.getElementById("inputPrioridade").value);

            // atualiza objeto atual
            dispositivoAtual.nome = novoNome;
            dispositivoAtual.prioridade = novaPrioridade;

            // atualiza na tela
            document.getElementById("nome").textContent = novoNome;
            document.getElementById("prioridade").textContent = novaPrioridade;

            // envia para o backend salvar no arquivo
            const resp = await fetch("/atualizar-json", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dispositivoAtual)
            });

            const resultado = await resp.json();
            alert(resultado.mensagem);
        });
    </script>

    <a href="/dispositivos">Voltar para os dispositivos</a>
</body>

</html>
